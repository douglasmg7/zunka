doctype html
html(lang="en")
  head
    meta(charset='utf-8')
    meta(name="viewport" content="width=device-width, initial-scale=1")
    title Endereços.
    include ../components/bootstrap.css.pug
  body
    include ../navbar.pug
    .container
      .row
        .col-md-12
          ol.breadcrumb
            li
              a(href='/users/account') Sua Conta
            li.active Seus Endereços
          h2.text-left Seus Endereços
          //- Flash erros.          
          if error
            each err in error
              .alert.alert-danger(role='alert') 
                p.text-center #{err} 
          //- Flash success.
          if success
            each suc in success
              .alert.alert-info(role='alert') 
                p.text-center #{suc}    
      .row
        .col-md-4
           a.not-decoration(href='address/add') 
            .addressPanel
              h3 Adicionar endereço
        //- Address list.
        if addresss
          each address in addresss
            .col-md-4
              .address-container(data-address-id=address._id)
                .table-row  
                  if address.default
                    .address-header Padrão
                .table-row  
                  .address-body             
                    p.name #{address.name}                                                                                                
                    p #{address.phone}                                                                                                
                    p #{address.cep}                                                                                                
                    p #{address.address}                                                                                                
                    p #{address.addressNumber}                                                                                                
                    p #{address.addressComplement}                                                                                                
                    p #{address.district}                                                                                                
                    p #{address.city}                                                                                                
                    p #{address.state}
                .table-row  
                  .address-footer                                                                          
                    span
                      a.edit-address(href=`address/edit?addressId=${address._id}`) Editar 
                      strong &nbsp | &nbsp                                                                                       
                      a.remove-address Apagar
                      strong &nbsp | &nbsp
                      a.set-default-address Marcar como padrão                   
    include ../components/jquery.js.pug
    include ../components/bootstrap.js.pug
  script.
    // Remove address.
    $('.remove-address').on('click', function(event){
      let $target = $(event.target);
      let $panel = $target.closest('.panel');
      let addressId = $panel.data('address-id');
      console.log(addressId);
      if (confirm('Confirma a remoção do endereço ?')) {
        $.ajax({
          method: 'PUT',
          url: 'address/remove/' + addressId,
          data: { _csrf: '#{csrfToken}'}
        })
        .done(function(result){
          // Remove address.
          $target.closest('.col-md-4').remove();
        });
      }
    });
    // Set address as default.
    $('.set-default-address').on('click', function(event){
      let $target = $(event.target);
      let $panel = $target.closest('.panel');
      let addressId = $panel.data('address-id');
      $.ajax({
        method: 'PUT',
        url: 'address/default/' + addressId,
        data: { _csrf: '#{csrfToken}'}
      })
      .done(function(result){
        // Change default adddress.
        // Find all address panels.
        $('.panel').filter('.address').each(function(){
          let $this = $(this);
          // Set as default.
          if($this.data('address-id') === addressId) {
            if($this.find('.panel-heading').length === 0){
              $this.prepend('<div class=panel-heading> Padrão </div>');
            }
          }
          // Unset as default. 
          else {
            $this.find('.panel-heading').remove();
          }
        });
      });
    });    
  style.
    .remove-address:hover,
    .edit-address:hover,
    .set-default-address:hover {
      cursor: pointer;
    }
    /* Add address */
    .addressPanel {
      display: table;
      width: 100%;
      border: 2px dashed gray;
      height: 350px;
      border-radius: 5px;
    }
    .addressPanel h3 {
      display: table-cell;
      vertical-align: middle;
      text-align: center;
    }
    a.not-decoration {
      text-decoration: none;
    }
    /* Adress panel*/
    .address-container{
      display: table;
      border: 2px solid lightgray;
      height: 350px;
      width: 100%;
      border-radius: 5px;
    }
    .table-row{
      display: table-row;
      width: 100%;
    }
    .address-header, 
    .address-body, 
    .address-footer{
      display: table-cell;
      width: 100%;
      padding: 1em;
    }
    .address-header{
      height: 3.5em;
      border-bottom: 2px solid lightgray;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;      
    }
    .address-body{
    }
    .address-footer{
      height: 3.5em;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 5px;    
    }
    .address-container p {
      height: 1em;
    }
    .address-container p.name {
      font-weight: bold;
    }    


    /*
    .address-container{
      position: relative;
      border: 2px solid lightgray;
      min-height: 450px;
      border-radius: 5px; 
    }
    .address-header, 
    .address-body, 
    .address-footer{
      padding: 1em;
    }
    .address-header{
      height: 3.5em;
      background-color: whitesmoke;
      border-bottom: 2px solid lightgray;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;      
    }
    .address-body{
      position: absolute;
      top: 3em;
      height: 100%;
      background-color: whitesmoke;
      max-height: 450px;
    }
    .address-footer{
      position: absolute;
      bottom: 2px;
      height: 3.5em;
      background-color: whitesmoke;
      border-top: 2px solid lightgray;
      border-bottom-left-radius: 5px;
      border-bottom-right-radius: 5px;    
    }
    */